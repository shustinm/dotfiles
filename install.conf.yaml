- clean: ['~']

- link:
    ~/.gitconfig: gitconfig
    ~/.zprofile: zprofile
    ~/.zshrc: zshrc
    ~/.zshenv: zshenv
    ~/.config/:
      path: config/*
      create: true
      force: true
      relink: true
      glob: true
    ~/.btt_autoload_preset.json:
      if: '[ `uname` = Darwin ]'
      path: btt/autoload.bttpreset
    ~/Brewfile:
      if: '[ `uname` = Darwin ]'
      path: Brewfile
    ~/.ideavimrc: jetbrains/.ideavimrc
    ~/.hushlogin: hushlogin

- create:
  - ~/Developer
  - ~/.config

- shell:
  - description: Install Homebrew (Mac Only)
    command: |
      if [ "$(uname -s)" = "Darwin" ]; then
        command -v homebrew >/dev/null || /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
      fi
    stdout: true
    stdin: true
  - description: Install Zerobrew (Mac Only)
    command: |
      if [ "$(uname -s)" = "Darwin" ]; then
        command -v zb >/dev/null || curl -fsSL https://zerobrew.rs/install | bash
      fi
    stdout: true
    stdin: true
  - description: Install Starship
    command: command -v starship >/dev/null || curl -sS https://starship.rs/install.sh | sh
    stdout: true
    stdin: true
  - description: Install packages
    command: |
      if [ "`uname`" = "Linux" ]; then
        id=$(awk -F= '/^ID=/{print $2}' /etc/os-release | tr -d '"')
        if [[ $id = *'ubuntu'* ]]; then
          sudo apt update
          sudo apt install -y $(cat apt/packages.txt)
        elif [[ $id = *'fedora'* ]]; then
          sudo dnf upgrade -y --refresh
          sudo dnf install -y epel-release 'dnf-command(config-manager)'
          while read in; do sudo rpm --import "$in"; done < dnf/rpm_keys.txt
          while read in; do sudo dnf config-manager --add-repo "$in"; done < dnf/repos.txt
          sudo ln -s $(pwd)/dnf/yum/* /etc/yum.repos.d/
          sudo dnf install -y $(cat dnf/packages.txt)
        fi
      fi
    stdout: true
    stdin: true
  - description: install nvim
    command: |
      if [ "$(uname -s)" = "Linux" ]; then
        if ! command -v nvim &> /dev/null; then
          curl -L -o nvim.appimage "https://github.com/neovim/neovim/releases/download/nightly/nvim-linux-$(uname -m).appimage"
          chmod u+x nvim.appimage
          sudo mv nvim.appimage /usr/bin/nvim
        fi
      fi
    stdout: true
    stdin: true
  - description: Install UV
    command: |
      if ! command -v uv &> /dev/null; then
        curl -LsSf https://astral.sh/uv/install.sh | sh
      fi
    stdout: true
    stdin: true
  - description: mac configuration
    command: |
      if [ "$(uname -s)" = "Darwin" ]; then
        find darwin -name '*.sh' -exec {} \;
      fi
    stdout: true
    stdin: true
